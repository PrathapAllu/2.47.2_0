import{m as p}from"./index-f7a5862e.js";import{s as h}from"./store-fcbe2a1f.js";import{w as c}from"./waitForPageSettled-5dce853c.js";import"./index-8b3efc3f.js";import"./_commonjsHelpers-de833af9.js";import"./v4-c70744d4.js";const m={enabled:!1,stages:{domContentLoaded:!0,windowLoad:!0,networkIdle:!0,fullySettled:!0,bestEffort:!0},timing:"document_start",saveLocally:!1,captureScreenshot:!0,maxWaitTime:1e4,settlementTimeout:500,checkInterval:100,allowedPendingRequests:0,weights:{dom:1,network:1,layout:1,longtask:1}};var b=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};b.SENTRY_RELEASE={id:"c7e5656e859d02ad6b0b543cae8f4abd4f8ff10c"};let i=!1,s,o=null;const r=new Set;function w(){var e;try{const n=((e=h.getState().flagsmith)==null?void 0:e.flags)||{},t=n.dom_settlement_capture===!0,a=n.dom_settlement_config;return{...m,...a,enabled:t,saveLocally:!0,stages:{domContentLoaded:!1,windowLoad:!1,networkIdle:!1,fullySettled:!0,bestEffort:!1}}}catch{return m}}function y(e){return!(e.startsWith("chrome://")||e.startsWith("chrome-extension://")||e.startsWith("about:")||e.startsWith("file://"))}async function d(e,n){if(!r.has(e)){r.add(e);try{const t=window.scrollX||window.pageXOffset||0,a=window.scrollY||window.pageYOffset||0,g={messageType:"domSettlementStage",stage:e,data:{url:window.location.href,timingMs:n,timestamp:Date.now(),scrollPosition:{x:t,y:a,atTop:a===0}}};await p.send("domSettlementStage",g)}catch{}}}function l(e){var n;if(!i&&y(window.location.href)){if(i=!0,s=performance.now(),(n=performance.timing)!=null&&n.navigationStart||Date.now(),r.clear(),e.stages.domContentLoaded)if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>{const t=performance.now()-s;d("domContentLoaded",t)});else{const t=performance.now()-s;d("domContentLoaded",t)}if(e.stages.windowLoad)if(document.readyState!=="complete")window.addEventListener("load",()=>{const t=performance.now()-s;d("windowLoad",t)});else{const t=performance.now()-s;d("windowLoad",t)}e.stages.networkIdle&&c(()=>{const t=performance.now()-s;d("networkIdle",t)},{timeoutMs:300,checkInterval:e.checkInterval,allowedPending:2,weights:{dom:.5,network:1,layout:.5,longtask:.5},enableLogging:!1}),e.stages.fullySettled&&(o=c(()=>{const t=performance.now()-s;d("fullySettled",t),i=!1,o=null},{timeoutMs:e.settlementTimeout,checkInterval:e.checkInterval,allowedPending:e.allowedPendingRequests,weights:e.weights,enableLogging:!1})),setTimeout(()=>{if(i&&!r.has("bestEffort")){const t=performance.now()-s;d("bestEffort",t),o&&(o(),o=null),i=!1}},e.maxWaitTime)}}function f(){if(window!==window.top)return;const e=w();if(e.enabled)switch(e.timing){case"document_start":l(e);break;case"document_idle":document.readyState==="complete"?l(e):window.addEventListener("load",()=>{setTimeout(()=>l(e),100)});break}}chrome.runtime.onMessage.addListener((e,n,t)=>{if(e.messageType==="startDomSettlementMonitoring"){const a=w();a.enabled&&a.timing==="on_record"&&(l(a),t({success:!0}))}else e.messageType==="stopDomSettlementMonitoring"&&(o&&(o(),o=null,i=!1),t({success:!0}));return!0}),f();let u=window.location.href;const L=new MutationObserver(()=>{window.location.href!==u&&(u=window.location.href,o&&(o(),o=null),i=!1,r.clear(),f())});L.observe(document.body,{childList:!0,subtree:!0});
