import{c as b,j as e}from"./Icon-8dd1dd62.js";import{r as u}from"./index-8b3efc3f.js";import{d as A}from"./index-13d794b2.js";import{F as D}from"./FAIcon-d24804f9.js";import{D as _}from"./DocumentIcon-f87a7824.js";import{t as j}from"./trackEventViaMessage-5bc40ab7.js";import{B as k}from"./Button-7b9bff07.js";import{o as I,D as S,a as R,A as T}from"./longRunningRecorder-5bbcc7ac.js";import{w as C,x as E,aj as $}from"./store-fcbe2a1f.js";import{a as B}from"./react-redux-52a3bd12.js";const O=({appIconName:d,iconUrl:a,size:r=44,isFlat:n,shadowed:t=!1,blurSM:p,smallGlow:h=!1,className:m})=>{const[o,i]=u.useState(!1),g=b("rounded mix-blend-multiply",{hidden:!o}),x=r,s=r/2,f=h?s:r*1.1;return e.jsxs("div",{className:b("relative h-fit w-fit",m),style:{width:x,height:x},children:[e.jsx("div",{className:b("relative z-[1] flex items-center justify-center rounded-full bg-gradient-to-b from-white to-slate-50",{"shadow-[0px_2px_6px_rgba(30,41,59,0.04),_0px_1px_2px_rgba(30,41,59,0.06)]":!n&&!t,"shadow-lg":t&&!n}),style:{width:s*2,height:s*2},children:e.jsx("img",{src:a,onLoad:()=>i(!0),className:g,width:s,height:s,"data-testid":"app-icon-image",alt:`${d} logo`})}),!n&&!t&&e.jsx("img",{alt:"","aria-hidden":!0,src:a,className:b("absolute bottom-0 left-0 right-0 m-auto rounded-full mix-blend-multiply",{"blur-sm":p,blur:!p}),style:{width:f,height:f},"data-testid":"glow-image"})]})},L=u.forwardRef(({type:d,className:a,...r},n)=>e.jsx("div",{ref:n,className:b("rounded-lg border border-slate-400 border-opacity-15 px-6 py-5 dark:border-slate-700 dark:border-opacity-25",d==="linked"?"cursor-pointer bg-slate-50 hover:border-opacity-25 dark:bg-slate-900 dark:hover:border-opacity-50":"bg-white dark:bg-slate-800",a),...r})),U=({logo:d,icon:a,iconColor:r="gray",leftIcon:n,iconPosition:t="center",title:p,capturedText:h,stepsText:m,ctaLabel:o="View",onCta:i,onDelete:g,className:x,onButtonClick:s,hoverOverlay:f=!0,topIcon:w,location:c,type:l,buttonIcon:y})=>{const z=()=>{s&&!f&&(j("suggested_scribe_card_clicked",{location:c,type:l}),s())},F=()=>{j("suggested_scribe_card_cta_clicked",{location:c}),i==null||i()},M=v=>{v.stopPropagation(),j("suggested_scribe_card_delete_clicked",{location:c,type:l}),g==null||g()},P=v=>{v.stopPropagation(),j("suggested_scribe_card_arrow_clicked",{location:c,type:l}),s==null||s()},N=n??(d?e.jsx(_,{logo:d}):a?e.jsx(_,{icon:a,color:r}):null);return e.jsxs(L,{className:b(`flex flex-row gap-4 p-4 relative cursor-pointer ${t==="top"?"items-start":t==="bottom"?"items-end":"items-center"}`,f&&"group",x),onClick:z,children:[N&&e.jsx("div",{className:`shrink-0 flex ${t==="top"?"items-start mt-[3px]":t==="bottom"?"items-end":"items-center"} justify-center`,children:N}),e.jsxs("div",{className:"flex flex-col flex-grow",children:[e.jsxs("div",{className:"p-0",children:[w&&e.jsx("div",{className:"mb-3 flex items-center",children:w}),e.jsx("h3",{className:"text-sm font-semibold leading-5 m-0",style:{width:"calc(100% + 50px)"},children:p})]}),e.jsx("div",{className:"p-0",children:e.jsxs("p",{className:"text-xs font-normal text-slate-500 m-0",children:[h,m?e.jsxs(e.Fragment,{children:["\xA0 | \xA0",m]}):null]})})]}),f&&e.jsxs("div",{className:b("absolute inset-0 z-10 flex items-center justify-center transition-opacity duration-150 rounded-lg opacity-0 pointer-events-none backdrop-blur-sm bg-white/60 group-hover:opacity-100 group-hover:pointer-events-auto"),children:[e.jsx(k,{size:"small",variant:"secondary",onClick:F,className:"mx-auto",children:o}),g&&e.jsx(k,{icon:A,variant:"secondary",size:"small",onClick:M,className:"absolute top-2 right-2 backdrop-blur-sm"})]}),s&&e.jsx(k,{variant:"ghost",size:"small",onClick:P,className:"ml-auto self-start",children:e.jsx(D,{icon:y||"arrowRight",variant:"solid",size:12,className:"text-slate-400"})})]})};async function q(d){return new Promise((a,r)=>{const n=indexedDB.open(S,R);n.onerror=()=>{r(new Error(`Failed to open ${S}`))},n.onsuccess=async t=>{try{const p=t.target.result,h=p.transaction([T],"readonly"),m=h.objectStore(T),o=new Map,i=d.map(g=>new Promise(x=>{const s=m.get(g);s.onsuccess=()=>{s.result&&o.set(g,s.result),x()}}));await Promise.all(i),h.oncomplete=()=>{p.close(),a(o)}}catch(p){r(p)}}})}const G=d=>{const[a,r]=u.useState([]),[n,t]=u.useState(!1),[p,h]=u.useState(null),m=u.useCallback(async()=>{C("feature","long-running-recorder"),C("operation","fetch-suggested-scribes");try{t(!0),h(null);const o=await I(),i=o.transaction(["suggestedScribes"],"readonly"),g=i.objectStore("suggestedScribes"),x=(await new Promise((c,l)=>{const y=g.getAll();y.onsuccess=()=>{c(y.result||[])},y.onerror=()=>{E(new Error("Failed to fetch suggested Scribes"),{extra:{context:"Failed to fetch suggested Scribes from database"}}),l(new Error("Failed to fetch suggested Scribes"))},i.oncomplete=()=>{o.close()}})).filter(c=>c.status==="pending"),s=new Set;x.forEach(c=>{c.actions.forEach(l=>{typeof l=="string"&&s.add(l)})});const f=await q(Array.from(s)),w=x.map(c=>({...c,actions:c.actions.map(l=>typeof l=="string"?f.get(l)||{id:l,description:"Action not found"}:l)}));r(w),t(!1)}catch(o){E(o,{extra:{context:"Error in fetchScribes"}}),h(o instanceof Error?o.message:"Unknown error occurred"),t(!1)}},[]);return u.useEffect(()=>{m()},[m,d]),u.useEffect(()=>{const o=i=>{(i==null?void 0:i.messageType)==="suggestedScribesUpdated"&&m()};try{chrome.runtime.onMessage.addListener(o)}catch{}return()=>{try{chrome.runtime.onMessage.removeListener(o)}catch{}}},[m]),{suggestedScribes:a,loading:n,error:p,refresh:m}},V=()=>{const d=B(),a=u.useCallback(async(r,n,t)=>{r.messageType==="loggedOut"&&(d($()),t()),r.messageType==="pingContentScript"&&t("success"),r.messageType==="getScreenDimensions"&&t({height:screen.height,width:screen.width,screenLeft:window.screenLeft,screenTop:window.screenTop}),r.messageType==="stopTaskRecording"&&window.postMessage({messageType:"stopTaskRecording"})},[]);u.useEffect(()=>(chrome.runtime.onMessage.addListener(a),()=>{chrome.runtime.onMessage.removeListener(a)}),[a])};export{O as A,L as C,U as S,G as a,V as u};
