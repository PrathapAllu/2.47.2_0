import"./modulepreload-polyfill-3cfb730f.js";import{j as t,c as M,a as re}from"./Icon-8dd1dd62.js";import{r as o,R as Ee}from"./index-8b3efc3f.js";import{c as $e}from"./client-842c76de.js";import{P as Ce}from"./react-redux-52a3bd12.js";import{y as D,k as F,s as Me}from"./store-fcbe2a1f.js";import{p as Re}from"./production-ca86ce5a.js";import{b as ze,c as Ie,d as ne,e as Pe}from"./index-13d794b2.js";import{B as Le,t as Te,g as Be}from"./googleFaviconServiceHelper-8a59a545.js";import{D as Ue}from"./DocumentIcon-f87a7824.js";import{g as O}from"./longRunningRecorder-5bbcc7ac.js";import{t as R}from"./trackEventViaMessage-5bc40ab7.js";import{B as T}from"./Button-7b9bff07.js";import{$ as De,a as oe,_ as ce}from"./index-971785a2.js";import{T as Fe}from"./Toolbar-bf89fd8a.js";import"./_commonjsHelpers-de833af9.js";import"./v4-c70744d4.js";import"./index-e7938b7c.js";import"./index-02c9c348.js";const le="Progress",V=100,[Ae,$t]=De(le),[We,He]=Ae(le),de=o.forwardRef((e,a)=>{const{__scopeProgress:r,value:d,max:u,getValueLabel:b=Xe,...E}=e,l=Q(u)?u:V,p=ue(d,l)?d:null,h=X(p)?b(p,l):void 0;return o.createElement(We,{scope:r,value:p,max:l},o.createElement(oe.div,ce({"aria-valuemax":l,"aria-valuemin":0,"aria-valuenow":X(p)?p:void 0,"aria-valuetext":h,role:"progressbar","data-state":me(p,l),"data-value":p??void 0,"data-max":l},E,{ref:a})))});de.propTypes={max(e,a,r){const d=e[a],u=String(d);return d&&!Q(d)?new Error(Ge(u,r)):null},value(e,a,r){const d=e[a],u=String(d),b=Q(e.max)?e.max:V;return d!=null&&!ue(d,b)?new Error(Ye(u,r)):null}};const Oe="ProgressIndicator",Ve=o.forwardRef((e,a)=>{var r;const{__scopeProgress:d,...u}=e,b=He(Oe,d);return o.createElement(oe.div,ce({"data-state":me(b.value,b.max),"data-value":(r=b.value)!==null&&r!==void 0?r:void 0,"data-max":b.max},u,{ref:a}))});function Xe(e,a){return`${Math.round(e/a*100)}%`}function me(e,a){return e==null?"indeterminate":e===a?"complete":"loading"}function X(e){return typeof e=="number"}function Q(e){return X(e)&&!isNaN(e)&&e>0}function ue(e,a){return X(e)&&!isNaN(e)&&e<=a&&e>=0}function Ge(e,a){return`Invalid prop \`max\` of value \`${e}\` supplied to \`${a}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${V}\`.`}function Ye(e,a){return`Invalid prop \`value\` of value \`${e}\` supplied to \`${a}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${V} if no \`max\` prop is set)
  - \`null\` if the progress is indeterminate.

Defaulting to \`null\`.`}const Ze=de,qe=Ve,Je=re("relative w-full overflow-hidden rounded-full shadow-inner",{variants:{variant:{primary:"bg-slate-200",success:"bg-green-400 bg-opacity-30"},size:{md:"h-1.5",lg:"h-2"}},defaultVariants:{variant:"primary",size:"md"}}),Ke=re("h-full w-full flex-1 rounded-full",{variants:{variant:{primary:"bg-gradient-to-r from-brand-600 to-brand-500",success:"bg-gradient-to-r from-green-500 to-green-400"}},defaultVariants:{variant:"primary"}}),Qe=o.forwardRef(({animate:e=!0,variant:a="primary",size:r="md",className:d,value:u,...b},E)=>t.jsx(Ze,{ref:E,className:M(Je({variant:a,size:r}),d),...b,children:t.jsx(qe,{className:M(Ke({variant:a}),{"transition-all":e}),style:{transform:`translateX(-${100-(u||0)}%)`}})})),et="FB923C",he=(e,a)=>{const r=Math.floor(a*255).toString(16).padStart(2,"0");return`${e}${r}`},tt=({x:e,y:a,color:r,animate:d})=>{const u=r||et;return t.jsx("div",{"data-testid":"action-click-target",className:M("pointer-events-none absolute left-0 top-0 size-11 overflow-hidden rounded-full border-2 transition-transform duration-300 will-change-[translate] group-hover:scale-125",d?"transition-[translate,transform]":"transition-transform"),style:{translate:`calc(-50% + ${e}px) calc(-50% + ${a}px)`,borderColor:he(`#${u}`,.75),backgroundColor:he(`#${u}`,.5)}})},st=.3,it=1.5,G=.1,at=({scale:e,minScale:a=st,maxScale:r=it,onChange:d,className:u})=>{const b=l=>Math.round(l*10)/10,E=o.useCallback(l=>p=>{p.stopPropagation();const h=e+(l==="in"?G:-G),_=b(h),f=_<a&&a||_>r&&r||_;(l==="in"&&_<=r||l==="out"&&_>=a)&&d(f)},[e,a,r,d]);return t.jsxs("div",{className:M("flex flex-col space-y-1 absolute bottom-2 right-2 z-1 bg-slate-800 bg-opacity-30 backdrop-blur-sm rounded-full p-1.5",u),children:[t.jsx(T,{className:M("flex items-center justify-center w-7 h-7 text-white rounded-full",e+G>r?"opacity-50 cursor-not-allowed":"hover:bg-slate-700/50"),onClick:E("in"),disabled:e+G>r,title:"Zoom in",icon:ze,variant:"ghost",size:"small"}),t.jsx(T,{className:M("flex items-center justify-center w-7 h-7 text-white rounded-full",e<=a?"opacity-50 cursor-not-allowed":"hover:bg-slate-700/50"),onClick:E("out"),disabled:e<=a,title:"Zoom out",icon:Ie,variant:"ghost",size:"small"})]})},rt=.7,nt=.8,ge=.3,pe=1.5,ee=e=>e&&typeof e=="object"&&"x"in e&&"y"in e&&typeof e.x=="number"&&typeof e.y=="number",fe=({screenshot:e,clickPosition:a,altText:r="",className:d})=>{var n,g;const u=o.useRef(null),[b,E]=o.useState(!1),[l,p]=o.useState({x:0,y:0}),[h,_]=o.useState(rt),[f,A]=o.useState({width:0,height:0}),[$,j]=o.useState(!1),[Y,y]=o.useState(window.devicePixelRatio||1);o.useEffect(()=>{const i=()=>{y(window.devicePixelRatio||1)},c=window.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);return c.addEventListener("change",i),()=>{c.removeEventListener("change",i)}},[]),o.useEffect(()=>{const i=()=>{p(c=>({...c}))};return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]);const S=((n=u.current)==null?void 0:n.clientWidth)||0,x=((g=u.current)==null?void 0:g.clientHeight)||0,z=f.width*h>S,I=f.height*h>x,P=z||I,v=o.useCallback(i=>{const c=f.width*h,m=f.height*h,N=S-c,k=x-m,w=z?N/2:0,C=I?k/2:0;return{x:Math.min(Math.max(i.x,w),-w),y:Math.min(Math.max(i.y,C),-C)}},[f,h,S,x,z,I]);o.useEffect(()=>{$&&p(i=>v(i))},[$,v]);const L=o.useCallback(()=>{if(ee(a)){const i=f.width/2,c=f.height/2,m=a.x,N=a.y;return{x:(i-m)*h,y:(c-N)*h}}return l},[a,f,h,l]),Z=o.useCallback(i=>{if(!P||i.button!==0)return;i.preventDefault(),E(!0);const c=i.clientX-l.x,m=i.clientY-l.y,N=w=>{const C=v({x:w.clientX-c,y:w.clientY-m});p(C)},k=()=>{E(!1),document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",k)};document.addEventListener("mousemove",N),document.addEventListener("mouseup",k)},[P,l,v]),B=a&&$?{x:a.x*h+l.x+(S-f.width*h)/2,y:a.y*h+l.y+(x-f.height*h)/2}:null,q=i=>{const c=i.currentTarget;A({width:c.naturalWidth,height:c.naturalHeight}),j(!0);const m=S/c.naturalWidth,N=x/c.naturalHeight;let k=Math.min(m,N)*nt;k=Math.max(k,ge),k=Math.min(k,pe);const w=k;if(_(w),ee(a)){const C=c.naturalWidth*w,U=c.naturalHeight*w,be=(S-C)/2,ve=(x-U)/2,W=a.x*w+be,H=a.y*w+ve;let J=0,K=0;W<0?J=-W:W>S&&(J=S-W),H<0?K=-H:H>x&&(K=x-H);const we=C>S,_e=U>x,je=S-C,ye=x-U,se=we?je/2:0,ie=_e?ye/2:0,ae=(Se,Ne,ke)=>Math.min(Math.max(Se,Ne),ke);p({x:ae(J,se,-se),y:ae(K,ie,-ie)})}else p({x:0,y:0})},s=o.useCallback(i=>{L();const c=i/h;if(ee(a)){const m=f.width/2,N=f.height/2,k=a.x,w=a.y,C=(m-k)*i,U=(N-w)*i;p(v({x:C,y:U}))}else{const m=l.x*c,N=l.y*c;p(v({x:m,y:N}))}_(i)},[L,a,f.height,f.width,v,h,l]);return t.jsxs("div",{ref:u,className:M("relative flex items-center justify-center overflow-hidden rounded-lg group",d),style:{height:"100%",width:"100%"},children:[t.jsxs("div",{className:"relative flex items-center justify-center bg-slate-100 h-full w-full",children:[e&&t.jsx("img",{src:e,alt:r,className:M("select-none transition-opacity duration-300 max-w-none",!b&&"transition-[translate,scale] will-change-[translate,scale]",P?b?"cursor-grabbing":"cursor-grab":"cursor-default"),style:{translate:`${l.x}px ${l.y}px`,scale:`${h}`,opacity:$?1:0},onMouseDown:Z,onLoad:q}),B&&$&&t.jsx(tt,{x:B.x,y:B.y,animate:!b}),$&&t.jsx(at,{scale:h,minScale:ge,maxScale:pe,onChange:s})]}),t.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-lg shadow-inner"})]})},te=({onBack:e,children:a,totalScribes:r,className:d})=>t.jsxs("div",{className:M("flex flex-col h-screen pt-4",d),children:[t.jsx(Fe,{className:"px-4",onVisitWorkspaceDocuments:()=>{},onGoToOptionsPage:()=>{},onBack:e,showTeamSelector:!1,showHomeIcon:!1,showSettingsIcon:!1,centerContent:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h4",{className:"text-md font-semibold m-0",children:"Auto-Captured Scribes"}),typeof r=="number"&&r>0&&t.jsx(Le,{children:r})]})}),a]}),ot=()=>{const[e,a]=o.useState(null),[r,d]=o.useState([]),[u,b]=o.useState([]),[E,l]=o.useState(!0),[p,h]=o.useState(!1),[_,f]=o.useState(!1),[A,$]=o.useState(null),[j,Y]=o.useState(new Set),[y,S]=o.useState(0),[x,z]=o.useState(0),I=o.useRef(null),P=()=>{I.current?I.current.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})},v=o.useCallback(async s=>{try{l(!0);const n=await chrome.runtime.sendMessage({messageType:"getSuggestedScribeForPreview",id:s});if(!n||!n.success)throw new Error((n==null?void 0:n.error)||"Failed to load scribe");const g=n.scribe;a(g);const i=g.actions.map(m=>({id:m.id||`action-${Math.random().toString(36).substring(2,9)}`,description:m.description||m.kind||"Unknown action",screenshot:m.screenshot,type:m.type,kind:m.kind,url:m.url||"",position:m.position||void 0}));d(i),b(i),Y(new Set),R("suggested_scribe_loaded",{location:"sidepanel_suggested_scribe_preview",scribe_id:g.id,scribe_title:g.title,scribe_domain:g.domain,total_steps:i.length,remaining_scribes:x,has_screenshots:i.some(m=>m.screenshot),screenshot_count:i.filter(m=>m.screenshot).length}),await chrome.storage.local.set({previewScribeId:s});const c=new URLSearchParams(window.location.search);c.set("id",s),window.history.replaceState(null,"",`${window.location.pathname}?${c}`)}catch(n){console.error("Error loading scribe:",n);const g=n instanceof Error?n.message:String(n);if(g.includes("Action not found"))try{await chrome.runtime.sendMessage({messageType:"updateSuggestedScribeStatus",id:s,status:"rejected"});const i=await O("pending");if(i.length>0){await v(i[0].id),P();return}await chrome.storage.local.remove(["previewScribeId"]),await D(F.RecommendedScribes);return}catch(i){console.error("Error during auto-reject fallback:",i)}R("suggested_scribe_load_failed",{location:"sidepanel_suggested_scribe_preview",scribe_id:s,error_message:g||"Unknown error occurred",remaining_scribes:x}),$(g||"Unknown error occurred")}finally{l(!1)}},[]);o.useEffect(()=>{(async()=>{let s=new URLSearchParams(window.location.search).get("id");s||(s=(await chrome.storage.local.get(["previewScribeId"])).previewScribeId),s?v(s):($("No scribe ID provided"),l(!1))})()},[v]),o.useEffect(()=>{chrome.storage.local.get(["totalSuggestedScribes"]).then(s=>{S(s.totalSuggestedScribes||0)})},[]),o.useEffect(()=>{chrome.storage.local.get(["suggestedScribes","rejectionCount"]).then(s=>{z(s.suggestedScribes||0)})},[]);const L=async()=>{R("suggested_scribe_preview_back_clicked",{location:"sidepanel_suggested_scribe_preview",scribe_id:e==null?void 0:e.id,scribe_title:e==null?void 0:e.title,scribe_domain:e==null?void 0:e.domain,total_steps:u.length,remaining_steps:r.length,deleted_steps_count:j.size,remaining_scribes:x}),await chrome.storage.local.remove(["previewScribeId"]),await D(F.RecommendedScribes)},Z=s=>{const n=r.find(i=>i.id===s);R("suggested_scribe_step_deleted",{location:"sidepanel_suggested_scribe_preview",scribe_id:e==null?void 0:e.id,scribe_title:e==null?void 0:e.title,scribe_domain:e==null?void 0:e.domain,step_id:s,step_description:n==null?void 0:n.description,step_type:n==null?void 0:n.type,step_kind:n==null?void 0:n.kind,steps_remaining_after_delete:r.length-1,total_deleted_steps:j.size+1});const g=new Set(j);g.add(s),Y(g),d(r.filter(i=>i.id!==s))},B=async()=>{if(e){R("add_auto_captured_scribe_clicked",{location:"extension",document_id:e.id,scribe_title:e.title,scribe_domain:e.domain,original_steps_count:u.length,final_steps_count:r.length,deleted_steps_count:j.size,remaining_scribes_after_accept:x-1,progress_percentage:y>1?(y-x+1)/y*100:0});try{h(!0);const s={...e,actions:u.filter(i=>!j.has(i.id)).map(i=>e.actions.find(c=>c.id===i.id)||i),source_actions:e.source_actions.filter(i=>{const c=u.find(m=>m.id===i);return c&&!j.has(c.id)})},n=await chrome.runtime.sendMessage({messageType:"updateSuggestedScribeStatus",id:e.id,status:"accepted",filteredActionIds:Array.from(j)});if(!n||!n.success)throw new Error((n==null?void 0:n.error)||"Failed to accept scribe");const g=await O("pending");if(g.length>0){z(g.length);const i=g[0];await v(i.id),P()}else await chrome.storage.local.remove(["previewScribeId"]),await D(F.RecommendedScribes);h(!1)}catch(s){console.error("Error accepting scribe:",s),R("suggested_scribe_accept_failed",{location:"sidepanel_suggested_scribe_preview",scribe_id:e.id,scribe_title:e.title,scribe_domain:e.domain,error_message:s instanceof Error?s.message:"Unknown error",final_steps_count:r.length,deleted_steps_count:j.size}),$(s instanceof Error?s.message:"Unknown error occurred"),h(!1)}}},q=async()=>{if(e){R("auto_captured_scribe_clicked",{location:"extension",document_id:e.id,scribe_title:e.title,scribe_domain:e.domain,original_steps_count:u.length,final_steps_count:r.length,deleted_steps_count:j.size,remaining_scribes_after_reject:x-1,progress_percentage:y>1?(y-x+1)/y*100:0});try{f(!0);const s=await chrome.runtime.sendMessage({messageType:"updateSuggestedScribeStatus",id:e.id,status:"rejected"});if(!s||!s.success)throw new Error((s==null?void 0:s.error)||"Failed to reject scribe");const{rejectionCount:n=0}=await chrome.storage.local.get(["rejectionCount"]),g=n+1;if(await chrome.storage.local.set({rejectionCount:g}),g%5===0&&g>0){const c=await O("pending");await chrome.storage.local.set({feedbackReturnState:{hasPendingScribes:c.length>0,nextScribeId:c.length>0?c[0].id:null}}),await chrome.storage.local.remove(["previewScribeId"]),await D(F.RecommendedScribesRejectionFeedback),f(!1);return}const i=await O("pending");if(i.length>0){const c=i[0];z(i.length),await v(c.id),P()}else await chrome.storage.local.remove(["previewScribeId"]),await D(F.RecommendedScribes);f(!1)}catch(s){console.error("Error rejecting scribe:",s),R("suggested_scribe_reject_failed",{location:"sidepanel_suggested_scribe_preview",scribe_id:e.id,scribe_title:e.title,scribe_domain:e.domain,error_message:s instanceof Error?s.message:"Unknown error",final_steps_count:r.length,deleted_steps_count:j.size}),$(s instanceof Error?s.message:"Unknown error occurred"),f(!1)}}};return E?t.jsx(te,{onBack:L,children:t.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-800 mb-6"}),t.jsx("p",{className:"text-base text-slate-600",children:"Loading scribe preview..."})]})}):A?t.jsx(te,{onBack:L,children:t.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-6",children:[t.jsxs("div",{className:"bg-red-50 text-red-700 p-4 rounded-lg mb-4 max-w-md",children:[t.jsx("div",{className:"font-semibold mb-2",children:"Error Loading Scribe"}),t.jsx("div",{className:"text-sm",children:A})]}),t.jsx(T,{variant:"primary",onClick:L,className:"mt-4",children:"Back to Suggestions"})]})}):t.jsxs(t.Fragment,{children:[t.jsx(te,{onBack:L,totalScribes:x,className:"bg-slate-50 pb-2",children:t.jsxs("div",{ref:I,className:"flex-1 overflow-y-auto pb-[60px] px-4",children:[y>1&&t.jsx(Qe,{className:"mt-6 mb-2",value:(y-x)/y*100,max:y}),t.jsx("div",{className:"flex-none px-4 py-4 bg-slate-50",children:e&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ue,{logo:{name:Te[(e==null?void 0:e.domain)||""]||(e==null?void 0:e.domain)||"",icon_url:Be((e==null?void 0:e.domain)||"",64)}}),t.jsx("h2",{className:"m-0 text-lg font-semibold text-slate-900",children:e.title})]})}),r.length===0?t.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:t.jsx("p",{className:"text-slate-600",children:"No steps found in this scribe."})}):t.jsx("div",{className:"space-y-6",children:r.map((s,n)=>t.jsxs("div",{className:"p-4 bg-white rounded-2xl shadow overflow-hidden relative",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:" items-center flex-shrink-0 h-8 w-8 bg-indigo-50 text-indigo-500 rounded-full flex justify-center font-bold text-base mr-3",children:n+1}),t.jsx("div",{className:"public-sans md:text-base text-sm text-slate-800 p1",children:s.description})]}),t.jsx(T,{onClick:()=>Z(s.id),className:M("h-8 w-8 p-0","hover:text-red-500","focus:text-red-500"),title:"Remove this step",icon:ne,variant:"ghost",size:"small"})]}),s.screenshot&&t.jsx("div",{className:"pt-4",children:t.jsx("div",{className:"rounded overflow-hidden",style:{height:"165px"},children:typeof s.screenshot=="string"?t.jsx(fe,{screenshot:s.screenshot,clickPosition:s.position,altText:`Step ${n+1}: ${s.description}`,className:"w-full h-full"}):typeof s.screenshot=="object"&&s.screenshot instanceof Blob?t.jsx(fe,{screenshot:URL.createObjectURL(s.screenshot),clickPosition:s.position,altText:`Step ${n+1}: ${s.description}`,className:"w-full h-full"}):t.jsx("div",{className:"h-full flex items-center justify-center bg-slate-200 text-slate-500 text-sm",children:"Screenshot unavailable"})})})]},s.id))})]})}),t.jsx("div",{className:"flex-none p-4 fixed bottom-0 left-0 right-0 backdrop-blur-xs bg-gradient-to-t from-white to-white/0",children:t.jsx("div",{className:"flex flex-col space-y-2",children:t.jsxs("div",{className:"flex space-x-2",children:[t.jsx(T,{variant:"secondary",className:"flex-1",onClick:q,disabled:p||_,icon:ne,children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[_&&t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-slate-200 border-b-slate-800"}),t.jsx("span",{children:"Discard"})]})}),t.jsx(T,{variant:"primary",className:"flex-1",onClick:B,disabled:p||_||r.length===0,icon:Pe,children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[p&&t.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white/20 border-b-white/100"}),t.jsx("span",{children:"Add Scribe"})]})})]})})})]})},ct=()=>t.jsxs(Ee.StrictMode,{children:[t.jsx("style",{type:"text/css",children:Re}),t.jsx(Ce,{store:Me,children:t.jsx(ot,{})})]}),xe=document.getElementById("root");xe&&$e(xe).render(t.jsx(ct,{}));
